# cbindgen configuration for kitchn_ffi
# See: https://github.com/mozilla/cbindgen/blob/master/docs.md

language = "C"
cpp_compat = true
include_version = true
autogen_warning = "/* AUTO-GENERATED by cbindgen - DO NOT EDIT */"

# Documentation style
documentation = true
documentation_style = "doxy"
documentation_length = "full"

# Header content with hardening macros
header = """/**
 * @file kitchn.h
 * @brief Kitchn FFI Interface - C bindings for the Kitchn library
 * 
 * Provides a stable C-ABI interface for configuration management,
 * logging, packaging, and ingredient processing.
 * 
 * @see https://github.com/ryugen/kitchn
 */

#ifndef KITCHN_H
#define KITCHN_H

/* Compiler feature detection and hardening macros */
#if defined(__GNUC__) || defined(__clang__)
  #define KITCHN_API __attribute__((visibility("default")))
  #define KITCHN_WARN_UNUSED_RESULT __attribute__((warn_unused_result))
  #define KITCHN_NONNULL(...) __attribute__((nonnull(__VA_ARGS__)))
  #define KITCHN_DEPRECATED(msg) __attribute__((deprecated(msg)))
  #define KITCHN_PRINTF(fmt, args) __attribute__((format(printf, fmt, args)))
#elif defined(_MSC_VER)
  #define KITCHN_API __declspec(dllexport)
  #define KITCHN_WARN_UNUSED_RESULT _Check_return_
  #define KITCHN_NONNULL(...)
  #define KITCHN_DEPRECATED(msg) __declspec(deprecated(msg))
  #define KITCHN_PRINTF(fmt, args)
#else
  #define KITCHN_API
  #define KITCHN_WARN_UNUSED_RESULT
  #define KITCHN_NONNULL(...)
  #define KITCHN_DEPRECATED(msg)
  #define KITCHN_PRINTF(fmt, args)
#endif

/* Thread safety annotations (Clang only) */
#if defined(__clang__) && defined(__has_attribute)
  #if __has_attribute(capability)
    #define KITCHN_CAPABILITY(x) __attribute__((capability(x)))
    #define KITCHN_REQUIRES(...) __attribute__((requires_capability(__VA_ARGS__)))
    #define KITCHN_EXCLUDES(...) __attribute__((locks_excluded(__VA_ARGS__)))
  #endif
#endif
#ifndef KITCHN_CAPABILITY
  #define KITCHN_CAPABILITY(x)
  #define KITCHN_REQUIRES(...)
  #define KITCHN_EXCLUDES(...)
#endif

/* Null pointer check helper */
#define KITCHN_ASSERT_NOT_NULL(ptr) \\
    do { if (!(ptr)) { return; } } while(0)
#define KITCHN_ASSERT_NOT_NULL_RET(ptr, ret) \\
    do { if (!(ptr)) { return (ret); } } while(0)"""

trailer = """
/* ABI version for runtime compatibility checks */
#define KITCHN_ABI_VERSION_MAJOR 0
#define KITCHN_ABI_VERSION_MINOR 1
#define KITCHN_ABI_VERSION_PATCH 1

/* End of kitchn.h */
#endif /* KITCHN_H */"""

# Formatting
line_length = 100
tab_width = 4
style = "both"

# Pointer configuration
[ptr]
# Use const for input parameters
non_null_attribute = "KITCHN_NONNULL"

[defines]
# Define platform-specific macros if needed

[export]
include = []
exclude = []
prefix = ""
item_types = ["constants", "globals", "enums", "structs", "unions", "typedefs", "opaque", "functions"]
# Add prefix for exported functions
rename = {}

[enum]
rename_variants = "None"
add_sentinel = false
prefix_with_name = false

[struct]
rename_fields = "None"
derive_constructor = false
derive_eq = false
derive_neq = false
derive_lt = false
derive_lte = false
derive_gt = false
derive_gte = false

[fn]
rename_args = "None"
args = "auto"
sort_by = "None"
# Mark functions returning pointers/ints that should be checked
must_use = "KITCHN_WARN_UNUSED_RESULT"

[parse]
parse_deps = false
clean = false

# After options - add attributes after function declarations
[export.body]
# Add HCORE_API to exported functions
